import kmeanplusplus_clustering as kmeanplusplus
import kmean_clustering as kmean
import math
import sorting
from ulab import numpy as np

# TODO: Implementations
# Initialize Variables
def data_stream_clustering(lists, W, k):
    # Change from Numpy to list
    if type(lists) is not list:
        lists = lists.tolist()
        

    length_lists = len(lists)
    count = 0
    p = 0 # cancel value
    check = True
    action = True
    internal_buffer = []

    while (action == True):
        max_size = W if check else (int(math.sqrt(W)) - 1)
        
        # print(f"COUNT = {count}")
        # if (length_lists - count + 1) < max_size:
        #     print("BREAK")
        #     print(f"Length of cluster: {(len(internal_buffer))}")
        #     break 

        for _ in range(0, max_size):
            # if count == length_lists - 1 or (length_lists - count + 1) < max_size:
            if count == length_lists - 1:
                action = False
                # print(f"FINAL COUNT = {count} and len list = {length_lists}")
                # print(f"Length of cluster: {(len(internal_buffer))}")
                break
            internal_buffer.append(lists[count]) #TODO: Append at the end of list for p fresh
            count += 1
        
        if internal_buffer and action: # If internal buffer is not empty
            # TODO: --- Apply Kmean plus plus ---
            # print("--- Len of internal buffer = ",len(internal_buffer))
            # internal_buffer = np.asarray(internal_buffer)
            centroids = kmeanplusplus.calculate_centroids(k, np.asarray(internal_buffer)) # Convert internal buffer from list to numpy
            clusters = kmeanplusplus.find_clusters(centroids, np.asarray(internal_buffer))

            ## TODO: Combine all cluster into one after finishing kmean plus plus algorithm
            internal_buffer = [] #Reset the internal buffer in order to add a new one
            for cluster in clusters:
                internal_buffer.extend(cluster)

            # TODO: --- Apply Quicksort ---
            sorting.quickSort_without_stack_or_recursion(internal_buffer, len(internal_buffer))
            # print(f"Length of cluster: {(len(internal_buffer))}")

            p = int(math.sqrt(W)) - 1 #p index 
            cancel_value = int((W/p) - 1)
            cancel_point = cancel_value
            for _ in range(p):
                del internal_buffer[cancel_point-1]
                cancel_point += cancel_value-1
            
            check = False #Change check from w to p
        else:
            # print("---------------- RESULT ----------------")
            # for item in internal_buffer:
            #     print(item)
            print(internal_buffer)

    # To run the code: ./micropython-2 data_stream_clustering.py

#TODO: - Testing
# lists = np.array([[6089, 28419], [10357, 8960], [9449, 8866], [32425, 28748], [30016, 11596], [27433, 31065], [28750, 30206], [28801, 32224], [9886, 26272], [27930, 13817], [8466, 10093], [21150, 23869], [22282, 16911], [22670, 17573], [12563, 13382], [12534, 31147], [12211, 11748], [7254, 13700], [17319, 22974], [31621, 6596], [34145, 8961], [7537, 8467], [10138, 5520], [34199, 10090], [7597, 10600], [12384, 26075], [31578, 27326], [14258, 31242], [26582, 29230], [13512, 7422], [6566, 32526], [5936, 8128], [11529, 13111], [12511, 31259], [12069, 7789], [32796, 30151], [9173, 29399], [28094, 31022], [27413, 32943], [14577, 9235], [16861, 22006], [28433, 8657], [28270, 28067], [32322, 28788], [20798, 16390], [23014, 19794], [30692, 27398], [12056, 30064], [13860, 33142], [13739, 29647], [9434, 33036], [13615, 6644], [12952, 28974], [10338, 9963], [31758, 9516], [10475, 30534], [12800, 8595], [20844, 17422], [8101, 8051], [11223, 26007], [29519, 7702], [6851, 29249], [13963, 33036], [6406, 29808], [26853, 28407], [27859, 7678], [32033, 7615], [12803, 30465], [31291, 8299], [5580, 8939], [29707, 14186], [26043, 29120], [14876, 29781], [21284, 22883], [8469, 7860], [6108, 7450], [6810, 31850], [6076, 32020], [29290, 33171], [33363, 7501], [33486, 8545], [25398, 9304], [10689, 5159], [15719, 19822], [27487, 26802], [29274, 30417], [9372, 31996], [32843, 28378], [33582, 7975], [27546, 34016], [8097, 31925], [13683, 28729], [22694, 19769], [14647, 31582], [30336, 33120], [18932, 23731], [30403, 11571], [13176, 6771], [26648, 10942], [12939, 10845], [16574, 19272], [13484, 8028], [30751, 31078], [11197, 29967], [28605, 32600], [29837, 30197], [7628, 28588], [9529, 13295], [33322, 9298], [12745, 10040], [12818, 26580], [10491, 33353], [26770, 32331], [27740, 12041], [30249, 27947], [20843, 22981], [15365, 19365], [28864, 7221], [9811, 25089], [22937, 22181], [8380, 10949], [5999, 8732], [13242, 7728], [29273, 11091], [12651, 26466], [30112, 31607], [21280, 17038], [12204, 29182], [31200, 8344], [13174, 32363], [7010, 8298], [20312, 22921], [12920, 11483], [11853, 12373], [31626, 14115], [8847, 25999], [22556, 16455], [29006, 34009], [19214, 24554], [7379, 13625], [15811, 21979], [19985, 17297], [33291, 33510], [14947, 29716], [8583, 13887], [8200, 29379], [8334, 6566], [7145, 28384], [12117, 27104], [30685, 9698], [26328, 26647], [31395, 8962], [20706, 22219], [14219, 28143], [28059, 14367], [28358, 6968], [11240, 14492], [27545, 7349], [20511, 20389], [32047, 30255], [31630, 5318], [12772, 8624], [31600, 8173], [32490, 27807], [9063, 9978], [31271, 25358], [29126, 7999], [12709, 31756], [33490, 30918], [30531, 6895], [13313, 31259], [9819, 30587], [29090, 31787], [9476, 34476], [27215, 32124], [32121, 11757], [6211, 27818], [34591, 11343], [7078, 13913], [14649, 8565], [32568, 8308], [27186, 6297], [13428, 27217], [26889, 28404], [13238, 29616], [11218, 30026], [16845, 18161], [7416, 29588], [34850, 9930], [33435, 11801], [28022, 9475], [34282, 32472], [13501, 6517], [7205, 28383], [16496, 23502], [15517, 18080], [13305, 10219], [32332, 33071], [13378, 30689], [26826, 27182], [8833, 31487], [30054, 14429], [30894, 6230], [13050, 30028], [29151, 12895], [17320, 17972], [30746, 32864], [29433, 33110], [19110, 23046], [29272, 14039], [31714, 11119], [32836, 9438], [9687, 9207], [16416, 21887], [19975, 20871], [23170, 19173], [17421, 17567], [11463, 11760], [18345, 22998], [8386, 29701], [26430, 31056], [11614, 11559], [9494, 29862], [11938, 25723], [9153, 26091], [7870, 27288], [8991, 27604], [26079, 32631], [6747, 30080], [30708, 5679], [7806, 30647], [9747, 14575], [28415, 30683], [6984, 8222], [17787, 21880], [12770, 12746], [21784, 16201], [32365, 33913], [33945, 12127], [32729, 9791], [33425, 30789], [5386, 28424], [9685, 31348], [21748, 19566], [28525, 9581], [31783, 27061], [14735, 10182], [19347, 24693], [32549, 10494], [20658, 16253], [17362, 17634], [26337, 12852], [32444, 13618], [6978, 32120], [27568, 27543], [27756, 27385], [7666, 31717], [31319, 28733], [30976, 25608], [9172, 33643], [12681, 28965], [28140, 29144], [21973, 22599], [8552, 12756], [11638, 7659], [10146, 34909], [29773, 29626], [7398, 8498], [17077, 19197], [11468, 25550], [27582, 34249], [6138, 32957], [31382, 32699], [31207, 30599], [6508, 12682], [7055, 29662], [32203, 33303], [19017, 23284], [34520, 32107], [9233, 28540], [14348, 31652], [10843, 9163], [11212, 28920], [6190, 30092], [18579, 24433], [29962, 12291], [15088, 20599], [30512, 13171], [5853, 12585], [17464, 21292], [28805, 7948], [25914, 12360], [10215, 7618], [34938, 10436], [26155, 30122], [11417, 30858], [11376, 7874], [27762, 34116], [33241, 11054], [32822, 12145], [28708, 34100], [5323, 10125], [29095, 13659], [11002, 6321], [33010, 32640], [16966, 18958], [31943, 31017], [30268, 32512], [28452, 8724], [23328, 18498], [29226, 13146], [29389, 8261], [11341, 6918], [29519, 25302], [29067, 14399], [21276, 24520], [12208, 30930], [23508, 19729], [7819, 7519], [26838, 6923], [19929, 15479], [21800, 17195], [34146, 28857], [12072, 33279], [10429, 34501], [27858, 31670], [12235, 11112], [31897, 32226], [21486, 16146], [6708, 30528], [26865, 10685], [22090, 20981], [9715, 31733], [12236, 14162], [9649, 11545], [12770, 12951], [20214, 22382], [11658, 32844], [28721, 31343], [16631, 20233], [23066, 23451], [11824, 13981], [31715, 8328], [31686, 14704], [30586, 12971], [29096, 31202], [8326, 5373], [8215, 34209], [22083, 15773], [8928, 31175], [9092, 10183], [22652, 23340], [10906, 14730], [12532, 30035], [23329, 22689], [16237, 22491], [9583, 7838], [30030, 28335], [8155, 26670], [8940, 7991], [11254, 5229], [29039, 10042], [29930, 13687], [6554, 33308], [32120, 11513], [32969, 33652], [7404, 6453], [30053, 31775], [31196, 9414], [22921, 18214], [6187, 10383], [21777, 19167], [18409, 20132], [34509, 12050], [14143, 31095], [8226, 10173], [22059, 19356], [7636, 13477], [10041, 27566], [5305, 31116], [27986, 14267], [7458, 30698], [24254, 19138], [25863, 30401], [23080, 20059], [11751, 31452], [26433, 31098], [32621, 14150], [34189, 27348], [27069, 13758], [21764, 17659], [13808, 11460], [30307, 29357], [28342, 33936], [34155, 12429], [16330, 16980], [20274, 22727], [6706, 33598], [12493, 9641], [27363, 9389], [32172, 11247], [29700, 8393], [16828, 23826], [15693, 22454], [31643, 5689], [8361, 32754], [7242, 31839], [31573, 10141], [15427, 20844], [19679, 19456], [15257, 20348], [9095, 25877], [31559, 30236], [9130, 7298], [32668, 31841], [26383, 10440], [25510, 8174], [22279, 21722], [8005, 32240], [30688, 27652], [9811, 30917], [13766, 8536], [13194, 12318], [6197, 27636], [33812, 28126], [26212, 28319], [14757, 8499], [29912, 9799], [30552, 9985], [14383, 8247], [6439, 11913], [16365, 17406], [8076, 31024], [7172, 33560], [28530, 28343], [6395, 27659], [27534, 28972], [26504, 8654], [33891, 28404], [10398, 25641], [19878, 15100], [11759, 12617], [13572, 27429], [18325, 15847], [25574, 8507], [23802, 21961], [12250, 34005], [22928, 21952], [34558, 9040], [28120, 31573], [26993, 9619], [13408, 12669], [30393, 5571], [32293, 11416], [9642, 31092], [28607, 29495], [31701, 28400], [29035, 28563], [33119, 32559], [11637, 11636], [30967, 33716], [10694, 26262], [20972, 16506], [11423, 14413], [8983, 34258], [29796, 8525], [13000, 27309], [26267, 10734], [28059, 33034], [13905, 7541], [9463, 33280], [14422, 11475], [10193, 26552], [7532, 13912], [32601, 11022], [28937, 31118], [32241, 11342], [33036, 28493], [19108, 16262], [18666, 23765], [33341, 32818], [18570, 23567], [31913, 8763], [10688, 32555], [23858, 18867], [27011, 9153], [29699, 26168], [14544, 9075], [26721, 28915], [29956, 6059], [30530, 30745], [12476, 31246], [31354, 26222], [33102, 8368], [31913, 30779], [19716, 23045], [18990, 19861], [34132, 10881], [11771, 32583], [16581, 17501], [12759, 8743], [29292, 12337], [23259, 21853], [25789, 29065], [27564, 26456], [10260, 7763], [34131, 9295], [7060, 26915], [27327, 27144], [7236, 8626], [26785, 33229], [8600, 30062], [11885, 9198], [16348, 16856], [27173, 10589], [11981, 32445], [12318, 10957], [5483, 8617], [30608, 11561], [28872, 11593], [34377, 8863], [27937, 12999], [24415, 22125], [9081, 7505], [10666, 7335], [30807, 34192], [21717, 15959], [29062, 31769], [24198, 18307], [8960, 27487], [7313, 31110], [28172, 11302], [9183, 26200], [7256, 10877], [31476, 8344], [7227, 8431], [31264, 32248], [10242, 14866], [22979, 23168], [8677, 7520], [8684, 26705], [14522, 8031], [30625, 31966], [10795, 34745], [10695, 14798], [27199, 10628], [30154, 31124], [8056, 7896], [30874, 33127], [21182, 22337], [27987, 9843], [7969, 10650], [23309, 23067], [33044, 6905], [7615, 8054], [30716, 8001], [22381, 17945], [9122, 26228], [9823, 31570], [31297, 7690], [10896, 26864], [29661, 29476], [18698, 18952], [24116, 22510], [12933, 10720], [11886, 6858], [6418, 9940], [29510, 32352], [12481, 30710], [12775, 13114], [26541, 9682], [29100, 27990], [10523, 33211], [29413, 5547], [32749, 10246], [9404, 9896], [27494, 13393], [20436, 22987], [31381, 6496], [19403, 21572], [18303, 18421], [6737, 26963], [30733, 25878], [27154, 30456], [33046, 28823], [10428, 30060], [13627, 27197], [12631, 31149], [26000, 27796], [5560, 28560], [29668, 34469], [11016, 27525], [7515, 31920], [20798, 17457], [21797, 19010], [13130, 26138], [9580, 9927], [9372, 25983], [14298, 10276], [8107, 33685], [21296, 16076], [31108, 29140], [21347, 16955], [31803, 7061], [5664, 9952], [9747, 32172], [6960, 28687], [19275, 16470], [26956, 6069], [31683, 9783], [27485, 28046], [18395, 24216], [27887, 5583], [7960, 28227], [31765, 5451], [28453, 10585], [26540, 6643], [31720, 12007], [31693, 26854], [15162, 19611], [27505, 9736], [31754, 12141], [19094, 15758], [21440, 23125], [7678, 31920], [6696, 30572], [26410, 28071], [23559, 21097], [28815, 7619], [32954, 30199], [6741, 32212], [6816, 27623], [9752, 29337], [8429, 14087], [6298, 30182], [6449, 27842], [6496, 32923], [9791, 7682], [32247, 30908], [31242, 5239], [30599, 33213]])

#---------------------------------------------------------
# Assume we have the length of "lists" is 641 points
# lists = np.array([[6089, 28419], [10357, 8960], [9449, 8866], [32425, 28748], [30016, 11596], [27433, 31065], [28750, 30206], [28801, 32224], [9886, 26272], [27930, 13817], [8466, 10093], [21150, 23869], [22282, 16911], [22670, 17573], [12563, 13382], [12534, 31147], [12211, 11748], [7254, 13700], [17319, 22974], [31621, 6596], [34145, 8961], [7537, 8467], [10138, 5520], [34199, 10090], [7597, 10600], [12384, 26075], [31578, 27326], [14258, 31242], [26582, 29230], [13512, 7422], [6566, 32526], [5936, 8128], [11529, 13111], [12511, 31259], [12069, 7789], [32796, 30151], [9173, 29399], [28094, 31022], [27413, 32943], [14577, 9235], [16861, 22006], [28433, 8657], [28270, 28067], [32322, 28788], [20798, 16390], [23014, 19794], [30692, 27398], [12056, 30064], [13860, 33142], [13739, 29647], [9434, 33036], [13615, 6644], [12952, 28974], [10338, 9963], [31758, 9516], [10475, 30534], [12800, 8595], [20844, 17422], [8101, 8051], [11223, 26007], [29519, 7702], [6851, 29249], [13963, 33036], [6406, 29808], [26853, 28407], [27859, 7678], [32033, 7615], [12803, 30465], [31291, 8299], [5580, 8939], [29707, 14186], [26043, 29120], [14876, 29781], [21284, 22883], [8469, 7860], [6108, 7450], [6810, 31850], [6076, 32020], [29290, 33171], [33363, 7501], [33486, 8545], [25398, 9304], [10689, 5159], [15719, 19822], [27487, 26802], [29274, 30417], [9372, 31996], [32843, 28378], [33582, 7975], [27546, 34016], [8097, 31925], [13683, 28729], [22694, 19769], [14647, 31582], [30336, 33120], [18932, 23731], [30403, 11571], [13176, 6771], [26648, 10942], [12939, 10845], [16574, 19272], [13484, 8028], [30751, 31078], [11197, 29967], [28605, 32600], [29837, 30197], [7628, 28588], [9529, 13295], [33322, 9298], [12745, 10040], [12818, 26580], [10491, 33353], [26770, 32331], [27740, 12041], [30249, 27947], [20843, 22981], [15365, 19365], [28864, 7221], [9811, 25089], [22937, 22181], [8380, 10949], [5999, 8732], [13242, 7728], [29273, 11091], [12651, 26466], [30112, 31607], [21280, 17038], [12204, 29182], [31200, 8344], [13174, 32363], [7010, 8298], [20312, 22921], [12920, 11483], [11853, 12373], [31626, 14115], [8847, 25999], [22556, 16455], [29006, 34009], [19214, 24554], [7379, 13625], [15811, 21979], [19985, 17297], [33291, 33510], [14947, 29716], [8583, 13887], [8200, 29379], [8334, 6566], [7145, 28384], [12117, 27104], [30685, 9698], [26328, 26647], [31395, 8962], [20706, 22219], [14219, 28143], [28059, 14367], [28358, 6968], [11240, 14492], [27545, 7349], [20511, 20389], [32047, 30255], [31630, 5318], [12772, 8624], [31600, 8173], [32490, 27807], [9063, 9978], [31271, 25358], [29126, 7999], [12709, 31756], [33490, 30918], [30531, 6895], [13313, 31259], [9819, 30587], [29090, 31787], [9476, 34476], [27215, 32124], [32121, 11757], [6211, 27818], [34591, 11343], [7078, 13913], [14649, 8565], [32568, 8308], [27186, 6297], [13428, 27217], [26889, 28404], [13238, 29616], [11218, 30026], [16845, 18161], [7416, 29588], [34850, 9930], [33435, 11801], [28022, 9475], [34282, 32472], [13501, 6517], [7205, 28383], [16496, 23502], [15517, 18080], [13305, 10219], [32332, 33071], [13378, 30689], [26826, 27182], [8833, 31487], [30054, 14429], [30894, 6230], [13050, 30028], [29151, 12895], [17320, 17972], [30746, 32864], [29433, 33110], [19110, 23046], [29272, 14039], [31714, 11119], [32836, 9438], [9687, 9207], [16416, 21887], [19975, 20871], [23170, 19173], [17421, 17567], [11463, 11760], [18345, 22998], [8386, 29701], [26430, 31056], [11614, 11559], [9494, 29862], [11938, 25723], [9153, 26091], [7870, 27288], [8991, 27604], [26079, 32631], [6747, 30080], [30708, 5679], [7806, 30647], [9747, 14575], [28415, 30683], [6984, 8222], [17787, 21880], [12770, 12746], [21784, 16201], [32365, 33913], [33945, 12127], [32729, 9791], [33425, 30789], [5386, 28424], [9685, 31348], [21748, 19566], [28525, 9581], [31783, 27061], [14735, 10182], [19347, 24693], [32549, 10494], [20658, 16253], [17362, 17634], [26337, 12852], [32444, 13618], [6978, 32120], [27568, 27543], [27756, 27385], [7666, 31717], [31319, 28733], [30976, 25608], [9172, 33643], [12681, 28965], [28140, 29144], [21973, 22599], [8552, 12756], [11638, 7659], [10146, 34909], [29773, 29626], [7398, 8498], [17077, 19197], [11468, 25550], [27582, 34249], [6138, 32957], [31382, 32699], [31207, 30599], [6508, 12682], [7055, 29662], [32203, 33303], [19017, 23284], [34520, 32107], [9233, 28540], [14348, 31652], [10843, 9163], [11212, 28920], [6190, 30092], [18579, 24433], [29962, 12291], [15088, 20599], [30512, 13171], [5853, 12585], [17464, 21292], [28805, 7948], [25914, 12360], [10215, 7618], [34938, 10436], [26155, 30122], [11417, 30858], [11376, 7874], [27762, 34116], [33241, 11054], [32822, 12145], [28708, 34100], [5323, 10125], [29095, 13659], [11002, 6321], [33010, 32640], [16966, 18958], [31943, 31017], [30268, 32512], [28452, 8724], [23328, 18498], [29226, 13146], [29389, 8261], [11341, 6918], [29519, 25302], [29067, 14399], [21276, 24520], [12208, 30930], [23508, 19729], [7819, 7519], [26838, 6923], [19929, 15479], [21800, 17195], [34146, 28857], [12072, 33279], [10429, 34501], [27858, 31670], [12235, 11112], [31897, 32226], [21486, 16146], [6708, 30528], [26865, 10685], [22090, 20981], [9715, 31733], [12236, 14162], [9649, 11545], [12770, 12951], [20214, 22382], [11658, 32844], [28721, 31343], [16631, 20233], [23066, 23451], [11824, 13981], [31715, 8328], [31686, 14704], [30586, 12971], [29096, 31202], [8326, 5373], [8215, 34209], [22083, 15773], [8928, 31175], [9092, 10183], [22652, 23340], [10906, 14730], [12532, 30035], [23329, 22689], [16237, 22491], [9583, 7838], [30030, 28335], [8155, 26670], [8940, 7991], [11254, 5229], [29039, 10042], [29930, 13687], [6554, 33308], [32120, 11513], [32969, 33652], [7404, 6453], [30053, 31775], [31196, 9414], [22921, 18214], [6187, 10383], [21777, 19167], [18409, 20132], [34509, 12050], [14143, 31095], [8226, 10173], [22059, 19356], [7636, 13477], [10041, 27566], [5305, 31116], [27986, 14267], [7458, 30698], [24254, 19138], [25863, 30401], [23080, 20059], [11751, 31452], [26433, 31098], [32621, 14150], [34189, 27348], [27069, 13758], [21764, 17659], [13808, 11460], [30307, 29357], [28342, 33936], [34155, 12429], [16330, 16980], [20274, 22727], [6706, 33598], [12493, 9641], [27363, 9389], [32172, 11247], [29700, 8393], [16828, 23826], [15693, 22454], [31643, 5689], [8361, 32754], [7242, 31839], [31573, 10141], [15427, 20844], [19679, 19456], [15257, 20348], [9095, 25877], [31559, 30236], [9130, 7298], [32668, 31841], [26383, 10440], [25510, 8174], [22279, 21722], [8005, 32240], [30688, 27652], [9811, 30917], [13766, 8536], [13194, 12318], [6197, 27636], [33812, 28126], [26212, 28319], [14757, 8499], [29912, 9799], [30552, 9985], [14383, 8247], [6439, 11913], [16365, 17406], [8076, 31024], [7172, 33560], [28530, 28343], [6395, 27659], [27534, 28972], [26504, 8654], [33891, 28404], [10398, 25641], [19878, 15100], [11759, 12617], [13572, 27429], [18325, 15847], [25574, 8507], [23802, 21961], [12250, 34005], [22928, 21952], [34558, 9040], [28120, 31573], [26993, 9619], [13408, 12669], [30393, 5571], [32293, 11416], [9642, 31092], [28607, 29495], [31701, 28400], [29035, 28563], [33119, 32559], [11637, 11636], [30967, 33716], [10694, 26262], [20972, 16506], [11423, 14413], [8983, 34258], [29796, 8525], [13000, 27309], [26267, 10734], [28059, 33034], [13905, 7541], [9463, 33280], [14422, 11475], [10193, 26552], [7532, 13912], [32601, 11022], [28937, 31118], [32241, 11342], [33036, 28493], [19108, 16262], [18666, 23765], [33341, 32818], [18570, 23567], [31913, 8763], [10688, 32555], [23858, 18867], [27011, 9153], [29699, 26168], [14544, 9075], [26721, 28915], [29956, 6059], [30530, 30745], [12476, 31246], [31354, 26222]])
# Assume we have the length of "lists" is 493 points
#---------------------------------------------------------
# W = 256 # W = window size either 256 or 2048
# k = 5 # Cluster Size
# data_stream_clustering(lists, W, k)